#!/bin/bash
# ------------------------------------------------------------------
# This script rebuilds the active i3 config by combining:
#   - config.base (the main i3 config with keybindings and so on)
#   - colors.i3   (theme file with color definitions, will be written to the top of the merged config file)
#
# Do not edit ~/.config/i3/config directly â€” it will be overwritten.
# ------------------------------------------------------------------

base="$HOME/.config/i3/config.base"
colors="$HOME/.config/i3/colors.i3"
out="$HOME/.config/i3/config"

if [[ ! -f "$base" ]]; then
  echo "Missing $base"; exit 1
fi
if [[ ! -f "$colors" ]]; then
  echo "Missing $colors (run theme-i3-colors first)"; exit 1
fi

# write the colors definition stub to tmp file, followed by the base configuration file
tmp="$(mktemp)"
{
  # echo header
  echo '#################################################' 
  echo '################# AUTOGENERATED #################'
  echo '#################################################' 
  echo '################# do not edit!! #################' 
  echo '#################################################'
  echo 
  echo '#################################################'
  echo '################### COLORS/FONT##################'
  echo '#################################################'
  echo
  cat "$colors"
  echo
  echo
  echo '#################################################' 
  echo '################### BASE CONFIG ##################'
  echo '#################################################' 
  
  cat "$base"
} > "$tmp"

# write tmp to the output file ~/.config/i3/config
mv "$tmp" "$out"

# Validate and reload i3
if i3 -C >/dev/null 2>&1; then
  i3-msg reload >/dev/null
  echo "Wrote $out and reloaded i3."
else
  echo "Wrote $out, but i3 -C reported errors."; exit 1
fi
